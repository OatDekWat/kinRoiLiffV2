<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap');
        body { font-family: 'Kanit', sans-serif; -webkit-tap-highlight-color: transparent; }
        .selected-table { background-color: #16a34a !important; color: white !important; border-color: #16a34a !important; }
    </style>
</head>
<body class="bg-gray-50 h-screen flex flex-col">

    <div class="bg-white p-4 shadow-sm sticky top-0 z-10 text-center">
        <h1 class="text-xl font-bold text-gray-800">üçΩÔ∏è ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ï‡πä‡∏∞‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</h1>
    </div>

    <div class="flex-1 overflow-y-auto p-4">
        <div id="tableContainer" class="grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3">
            </div>
    </div>

    <div id="bookingSheet" class="fixed bottom-0 left-0 right-0 bg-white rounded-t-3xl shadow-[0_-5px_20px_rgba(0,0,0,0.1)] transform translate-y-full transition-transform duration-300 z-50 p-6 pb-10">
        
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-bold text-gray-800">‡∏à‡∏≠‡∏á‡πÇ‡∏ï‡πä‡∏∞ <span id="lblTableNo" class="text-green-600"></span></h3>
            <button onclick="closeSheet()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
        </div>

        <form onsubmit="event.preventDefault(); sendBooking();" class="space-y-4">
            <div>
                <input type="text" id="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á" required
                    class="w-full bg-gray-100 px-4 py-3 rounded-xl outline-none focus:ring-2 focus:ring-green-500">
            </div>
            <div>
                <input type="tel" id="phone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" required
                    class="w-full bg-gray-100 px-4 py-3 rounded-xl outline-none focus:ring-2 focus:ring-green-500">
            </div>
            <div>
                <input type="datetime-local" id="time" required
                    class="w-full bg-gray-100 px-4 py-3 rounded-xl outline-none focus:ring-2 focus:ring-green-500 text-gray-600">
            </div>

            <button type="submit" 
                class="w-full bg-green-600 hover:bg-green-700 active:bg-green-800 text-white font-bold py-3 rounded-xl text-lg shadow-lg transition-all transform active:scale-95">
                ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
            </button>
        </form>
    </div>

    <div id="overlay" onclick="closeSheet()" class="fixed inset-0 bg-black bg-opacity-40 hidden z-40"></div>

    <script>
        // --- ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ ---
        const LIFF_ID = "2008852653-NMn9sh6P"; // ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        const TABLE_COUNT = 14;

        let currentTable = null;

        // --- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ---
        async function main() {
            try {
                await liff.init({ liffId: LIFF_ID });
                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô‡πÑ‡∏•‡∏ô‡πå ‡∏°‡∏±‡∏ô‡∏à‡∏∞ login ‡πÄ‡∏≠‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÑ‡∏°‡πà‡πÄ‡∏î‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤ login
                if (!liff.isLoggedIn() && liff.isInClient()) {
                    liff.login();
                }
            } catch (err) {
                console.error("LIFF Init Error:", err);
            }
            renderTables();
        }

        // --- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏°‡πÇ‡∏ï‡πä‡∏∞ ---
        function renderTables() {
            const container = document.getElementById('tableContainer');
            let html = '';
            for (let i = 1; i <= TABLE_COUNT; i++) {
                html += `
                    <button onclick="openSheet(${i})" id="btn-${i}"
                        class="aspect-square bg-white border-2 border-gray-200 rounded-2xl flex flex-col items-center justify-center transition-all hover:border-green-500 hover:shadow-md">
                        <span class="text-3xl mb-1">ü™ë</span>
                        <span class="font-bold text-gray-600">T-${i}</span>
                    </button>
                `;
            }
            container.innerHTML = html;
        }

        // --- ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î Form ---
        function openSheet(tableNo) {
            currentTable = tableNo;
            
            // Reset Active State
            document.querySelectorAll('button').forEach(b => b.classList.remove('selected-table'));
            document.getElementById(`btn-${tableNo}`).classList.add('selected-table');

            // Set Data
            document.getElementById('lblTableNo').innerText = tableNo;
            
            // Set Default Time (Current Time)
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('time').value = now.toISOString().slice(0, 16);

            // Show Sheet
            document.getElementById('overlay').classList.remove('hidden');
            document.getElementById('bookingSheet').classList.remove('translate-y-full');
        }

        function closeSheet() {
            document.getElementById('overlay').classList.add('hidden');
            document.getElementById('bookingSheet').classList.add('translate-y-full');
            if(currentTable) document.getElementById(`btn-${currentTable}`).classList.remove('selected-table');
            currentTable = null;
        }

        // --- ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏•‡∏ô‡πå (Core Function) ---
        async function sendBooking() {
            const name = document.getElementById('name').value;
            const phone = document.getElementById('phone').value;
            const time = document.getElementById('time').value;

            // ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢
            const d = new Date(time);
            const dateStr = d.toLocaleDateString('th-TH', {day:'numeric', month:'short', year:'2-digit'});
            const timeStr = d.toLocaleTimeString('th-TH', {hour:'2-digit', minute:'2-digit'});

            const msg = `üìå ‡∏à‡∏≠‡∏á‡πÇ‡∏ï‡πä‡∏∞ ${currentTable}\n‡∏ä‡∏∑‡πà‡∏≠: ${name}\n‡πÇ‡∏ó‡∏£: ${phone}\n‡πÄ‡∏ß‡∏•‡∏≤: ${dateStr} ${timeStr}`;

            try {
                if (liff.isInClient()) {
                    // ‡∏Å‡∏£‡∏ì‡∏µ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô‡πÑ‡∏•‡∏ô‡πå: ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á
                    await liff.sendMessages([{ type: 'text', text: msg }]);
                    liff.closeWindow(); 
                } else {
                    // ‡∏Å‡∏£‡∏ì‡∏µ‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏ô‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå (Test Mode): ‡πÅ‡∏™‡∏î‡∏á Alert ‡πÅ‡∏ó‡∏ô
                    alert("‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°:\n\n" + msg);
                    console.log("Message Sent:", msg);
                }
            } catch (error) {
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + error);
                console.error(error);
            }
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°
        main();
    </script>
</body>
</html>